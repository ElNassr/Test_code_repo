Sub RearrangeTestCases()
    Dim sws As Worksheet
    Dim tws As Worksheet
    Dim lastRow As Long
    Dim newRow_s As Long ' Corrected variable name
    Dim newRow_t As Long ' Corrected variable name
    Dim key As String
    Dim name As String
    Dim objective As String
    Dim feature As String
    Dim testSteps As String
    Dim emptyCellCount As Long
    Dim testStepCount As Long
    Dim i As Long
    
    ' Set references to source and target sheets
    Set sws = ThisWorkbook.Sheets("Sheet1") ' Change "Sheet1" to your source sheet name
    Set tws = ThisWorkbook.Sheets("Sheet2") ' Change "Sheet2" to your target sheet name
    
    ' Find the last row in column F of source sheet
    lastRow = sws.Cells(sws.Rows.count, "F").End(xlUp).Row
    
    ' Count the number of non-empty cells in column A of source sheet
    RowCount = CountNonEmptyCellsInColumn(1)
    
    ' Initialize variables
    feature = "Initial string"
    newRow_s = 2
    newRow_t = 1
    
    ' Loop through each row in the source sheet
    For i = 1 To RowCount - 1
        ' New test case
        key = sws.Cells(newRow_s, 1).Value
        name = sws.Cells(newRow_s, 2).Value
        objective = sws.Cells(newRow_s, 4).Value
        
        ' Check if the feature has changed
        If feature <> sws.Cells(newRow_s, 5).Value Then
            feature = sws.Cells(newRow_s, 5).Value
            
            ' Write "Feature" label and the feature value in the target sheet
            With tws.Cells(newRow_t, 1)
                .Value = "Feature"
                .Font.Bold = True ' Make the text bold
                .Interior.Color = RGB(173, 216, 230) ' Set light blue background color
            End With
            tws.Cells(newRow_t, 2).Value = feature ' Write the feature value
            
            ' Increment newRow_t to the next row for the next feature
            newRow_t = newRow_t + 1
        End If
        
        ' Write key and name in the target sheet
        tws.Cells(newRow_t, 1).Value = key
        tws.Cells(newRow_t, 2).Value = "Name"
        
        ' Write objective in the target sheet
        tws.Cells(newRow_t + 1, 2).Value = "Objective"
        
        ' Find number of test steps
        emptyCellCount = 0
        Do While sws.Cells(newRow_s + emptyCellCount + 1, 1).Value = "" And (newRow_s + emptyCellCount + 1) <= lastRow
            emptyCellCount = emptyCellCount + 1
        Loop
        
        ' Write test steps in the target sheet
        tws.Cells(newRow_t + 2, 2).Value = "Test steps"
        sws.Range(sws.Cells(newRow_s, 6), sws.Cells(newRow_s + emptyCellCount, 6)).Copy tws.Cells(newRow_t + 2, 3)
        
        ' Move to the next test case
        newRow_s = newRow_s + 1 + emptyCellCount
        newRow_t = newRow_t + 4 + emptyCellCount
    Next i
End Sub
